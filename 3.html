<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ultimate POS ‚Äì Filter Sub-Kategori</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Pencetakan Label yang Ditingkatkan untuk POS</h1>
        <h1>üñ®Ô∏èüè∑Ô∏èüí≥</h1>
        <p>
          Panduan ini mendemonstrasikan cara meningkatkan fungsionalitas
          pencetakan label di POS dengan UI/UX yang lebih baik, pembuatan
          barcode yang dioptimalkan, dan kemampuan cetak yang lebih baik.
        </p>
      </header>

      <div class="download-box">
        <a
          href="assets/ultimate-pos-filter.zip"
          download
          class="download-button"
        >
          ‚¨áÔ∏è Unduh File Contoh
        </a>
      </div>
      <!-- HOME -->
      <div class="home-button-wrapper">
        <a href="index.html" class="home-button">üè† Kembali ke Beranda</a>
      </div>

      <section>
        <h2>Gambaran Umum</h2>
        <p>Sistem pencetakan label yang diTingkatkan menyediakan:</p>
        <ul>
          <li>
            Antarmuka yang modern dan responsif dengan sakelar sakelar dan
            kontrol ukuran
          </li>
          <li>
            Barcode yang dioptimalkan dan pembuatan kode QR untuk kualitas cetak
            yang lebih baik
          </li>
          <li>Pratinjau yang diTingkatkan dengan pembaruan waktu nyata</li>
          <li>Fungsionalitas cetak yang dioptimalkan untuk printer label</li>
          <li>Penanganan gambar yang lebih baik dan pemformatan mata uang</li>
        </ul>
        <h2>Prasyarat: Pengaturan Dukungan Kode QR</h2>
        <p>
          Sebelum menggunakan sistem pencetakan label yang diTingkatkan dengan
          kode QR, Anda perlu menambahkan dukungan kode QR ke pengaturan kode
          batang jika belum ada.
        </p>

        <h2>Menambahkan Pengaturan Barcode Kode QR</h2>
        <p>
          Jika Anda ingin menambahkan "Untuk Kode QR" sebagai opsi pengaturan
          barcode, jalankan perintah SQL ini di database Anda:
        </p>
        <pre><code>
            INSERT INTO `barcodes` VALUES (7,'For Qr Code',NULL,0.9000,0.9000,10.0000,10.0000,0.0000,0.0000,0.1000,0.1000,1,0,0,1,1,'2025-06-07 00:00:00','2025-06-07 00:00:00');
        </code></pre>
        <div class="image-box">
          <img
            src="https://ultimate-pos-tutorials.vercel.app/assets/images/for-qrcode-3c833389b5bcf260dd5a701f362eecc8.png"
            alt="#"
          />
          <p class="caption">Gambar: Menambahkan Pengaturan Barcode Kode QR.</p>
        </div>
        <p>
          QR Code barcode setting "For Qr Code" available in the dropdown after
          running the SQL command
        </p>

        <h2>Pratinjau Antarmuka yang Ditingkatkan</h2>
        <div class="image-box">
          <img
            src="https://ultimate-pos-tutorials.vercel.app/assets/images/enhanced-labels-qr-interface-acb86261d58602ff586dd44d8862a83a.png"
            alt="#"
          />
          <p class="caption">Gambar: Pratinjau Antarmuka yang Ditingkatkan.</p>
        </div>
        <p>
          Antarmuka pencetakan label yang diTingkatkan, menampilkan label kode
          QR dengan kontrol sakelar modern
        </p>

        <h2>Fitur antarmuka yang diTingkatkan:</h2>
        <ul>
          <li>
            Panel Kiri: Sakelar sakelar modern untuk mengaktifkan/menonaktifkan
            elemen label
          </li>
          <li>
            Kontrol Ukuran: Tombol plus/minus dengan input numerik untuk ukuran
            yang tepat
          </li>
          <li>
            Pratinjau Waktu Nyata: Pembaruan pratinjau instan saat Anda
            menyesuaikan pengaturan
          </li>
          <li>
            Beberapa Opsi Cetak: Pencetakan standar, pengoptimalan printer
            label, dan mode khusus QR
          </li>
        </ul>
      </section>

      <section>
        <h2>‚úÖ Langkah 1: Tambahkan Route</h2>
        <p>
          Tambahkan routes label yang telah diTingkatkan ke file
          <code>routes/web.php</code> Anda:
        </p>
        <pre><code>
            // Enhanced Print Labels Routes
Route::get('/labels/enhanced-show', [LabelsController::class, 'enhancedShow'])->name('labels.enhanced-show');
Route::get('/labels/enhanced-preview', [LabelsController::class, 'enhancedPreview'])->name('labels.enhanced-preview');
        </code></pre>
      </section>

      <section>
        <h2>‚úÖ Langkah 2: Perbarui Controller</h2>
        <p>
          Tambahkan metode berikut ini ke aplikasi
          <code>app/Http/Controllers/LabelsController.php</code>:
        </p>
        <h3>Metode Pertunjukan Yang Ditingkatkan</h3>
        <pre><code>
            /**
 * Enhanced label printing interface
 */
public function enhancedShow(Request $request)
{
    $business_id = $request->session()->get('user.business_id');
    $purchase_id = $request->get('purchase_id', false);
    $product_id = $request->get('product_id', false);

    //Get products for the business
    $products = [];
    $price_groups = [];
    if ($purchase_id) {
        $products = $this->transactionUtil->getPurchaseProducts($business_id, $purchase_id);
    } elseif ($product_id) {
        $products = $this->productUtil->getDetailsFromProduct($business_id, $product_id);
    }

    //get price groups
    $price_groups = [];
    if (! empty($purchase_id) || ! empty($product_id)) {
        $price_groups = SellingPriceGroup::where('business_id', $business_id)
            ->active()
            ->pluck('name', 'id');
    }

    $barcode_settings = Barcode::where('business_id', $business_id)
        ->orWhereNull('business_id')
        ->select(DB::raw('CONCAT(name, ", ", COALESCE(description, "")) as name, id, is_default'))
        ->get();
    $default = $barcode_settings->where('is_default', 1)->first();
    $barcode_settings = $barcode_settings->pluck('name', 'id');

    // Fetch the business logo path
    $business_logo = request()->session()->get('business.logo');
    if (! empty($business_logo)) {
        $business_logo = asset('uploads/business_logos/' . $business_logo);
    }

    return view('labels.enhanced-show')
        ->with(compact('products', 'barcode_settings', 'default', 'price_groups', 'business_logo'));
}

/**
 * Enhanced preview method (reuses existing logic)
 */
public function enhancedPreview(Request $request)
{
    // Reuse the existing show_label_preview method
    return $this->show_label_preview($request);
}
        </code></pre>
        <h3>Metode Pengoptimalan yang Ditingkatkan</h3>
        <p>
          Tambahkan metode pengoptimalan ini untuk meningkatkan kualitas kode
          batang dan kode QR:
        </p>
        <pre><code>
            /**
 * Generate optimized barcode with dynamic sizing
 */
private function generateOptimizedBarcode($data, $label_width_inches, $barcode_size_setting)
{
    $width_factor = $this->calculateOptimalBarcodeWidth($label_width_inches);
    $height_pixels = max(40, $barcode_size_setting * 40);

    $dns1d = new DNS1D();
    $barcode = $dns1d->getBarcodePNG(
        $data,
        'C128',
        $width_factor,
        $height_pixels,
        [0, 0, 0],
        true
    );

    return $barcode;
}

/**
 * Calculate optimal barcode width factor based on label dimensions
 */
private function calculateOptimalBarcodeWidth($label_width_inches)
{
    if ($label_width_inches <= 1.5) {
        return 4; // Narrow labels
    } elseif ($label_width_inches <= 2.5) {
        return 6; // Medium labels
    } else {
        return 8; // Wide labels
    }
}

/**
 * Generate high-resolution QR code with error correction
 */
private function generateOptimizedQRCode($data, $size_setting)
{
    $pixel_size = max(120, $size_setting * 80);

    $dns2d = new DNS2D();
    $qr_code = $dns2d->getBarcodePNG(
        $data,
        'QRCODE',
        $pixel_size,
        $pixel_size,
        [0, 0, 0],
        false,
        3
    );

    return $qr_code;
}

/**
 * Get label image URL from settings
 */
public function getLabelImageUrlFromSettings($business_id)
{
    $business_logo = request()->session()->get('business.logo');
    if (! empty($business_logo)) {
        $business_logo = asset('uploads/business_logos/' . $business_logo);
    }
    return $business_logo;
}
        </code></pre>
        <h3>Metode Pratinjau yang Ditingkatkan</h3>
        <p>
          Perbarui metode <code>show_label_preview</code> yang sudah ada untuk
          menyertakan pengoptimalan:
        </p>
        <pre><code>
            /**
 * Enhanced show_label_preview method with optimizations
 */
public function show_label_preview(Request $request)
{
    try {
        $products = $request->get('products');
        $print = $request->get('print');
        $barcode_setting = $request->get('barcode_setting');
        $business_id = $request->session()->get('user.business_id');

        $barcode_details = Barcode::find($barcode_setting);
        $barcode_details->stickers_in_one_sheet = $barcode_details->is_continuous ? $barcode_details->stickers_in_one_row : $barcode_details->stickers_in_one_sheet;
        $barcode_details->paper_height = $barcode_details->is_continuous ? $barcode_details->height : $barcode_details->paper_height;

        if ($barcode_details->stickers_in_one_row == 1) {
            $barcode_details->col_distance = 0;
            $barcode_details->row_distance = 0;
        }

        $business_name = $request->session()->get('business.name');

        // Handle image source selection
        $image_url = null;
        if (!empty($print['image'])) {
            if ($print['image_source'] === 'select_image' && !empty($print['select_image_url'])) {
                $image_url = $print['select_image_url'];
            } elseif ($print['image_source'] === 'label_image') {
                $image_url = $this->getLabelImageUrlFromSettings($business_id);
            }
        }

        $product_details_page_wise = [];
        $total_qty = 0;

        foreach ($products as $value) {
            $details = $this->productUtil->getDetailsFromVariation($value['variation_id'], $business_id, null, false);

            // Format prices properly
            $details->sell_price_inc_tax = $this->productUtil->num_f($details->sell_price_inc_tax) ?: $details->sell_price_inc_tax;
            $details->default_sell_price = $this->productUtil->num_f($details->default_sell_price) ?: $details->default_sell_price;

            if (!empty($value['exp_date'])) {
                $details->exp_date = $value['exp_date'];
            }
            if (!empty($value['packing_date'])) {
                $details->packing_date = $value['packing_date'];
            }
            if (!empty($value['lot_number'])) {
                $details->lot_number = $value['lot_number'];
            }

            if (!empty($value['price_group_id'])) {
                $tax_id = $print['price_type'] == 'inclusive' ?: $details->tax_id;
                $group_prices = $this->productUtil->getVariationGroupPrice($value['variation_id'], $value['price_group_id'], $tax_id);
                $details->sell_price_inc_tax = $group_prices['price_inc_tax'];
                $details->default_sell_price = $group_prices['price_exc_tax'];
            }

            for ($i = 0; $i < $value['quantity']; $i++) {
                $page = intdiv($total_qty, $barcode_details->stickers_in_one_sheet);

                if ($total_qty % $barcode_details->stickers_in_one_sheet == 0) {
                    $product_details_page_wise[$page] = [];
                }

                // OPTIMIZATION: Pre-generate optimized barcodes and QR codes
                if (!empty($print['barcode'])) {
                    $details->optimized_barcode = $this->generateOptimizedBarcode(
                        $details->sub_sku,
                        $barcode_details->width,
                        $print['barcode_size'] ?? 0.8
                    );
                }

                if (!empty($print['qrcode'])) {
                    $details->optimized_qrcode = $this->generateOptimizedQRCode(
                        $details->sub_sku,
                        $print['qrcode_size'] ?? 1.4
                    );
                }

                $product_details_page_wise[$page][] = $details;
                $total_qty++;
            }
        }

        $margin_top = $barcode_details->is_continuous ? 0 : $barcode_details->top_margin * 1;
        $margin_left = $barcode_details->is_continuous ? 0 : $barcode_details->left_margin * 1;
        $paper_width = $barcode_details->paper_width * 1;
        $paper_height = $barcode_details->paper_height * 1;

        $i = 0;
        $len = count($product_details_page_wise);
        $is_first = false;
        $is_last = false;

        $factor = (($barcode_details->width / $barcode_details->height)) / ($barcode_details->is_continuous ? 2 : 4);
        $html = '';

        foreach ($product_details_page_wise as $page => $page_products) {
            $output = view('labels.partials.enhanced_preview')  // Use enhanced template
                ->with(compact('print', 'page_products', 'business_name', 'barcode_details', 'margin_top', 'margin_left', 'paper_width', 'paper_height', 'is_first', 'is_last', 'factor', 'image_url'))
                ->render();

            $html .= $output;
        }

        return response()->json(['success' => true, 'html' => $html]);
    } catch (\Exception $e) {
        \Log::emergency('File:' . $e->getFile() . 'Line:' . $e->getLine() . 'Message:' . $e->getMessage());

        return response()->json([
            'success' => false,
            'msg' => __('lang_v1.barcode_label_error')
        ]);
    }
}
        </code></pre>
      </section>

      <section>
        <h2>‚úÖ Langkah 3: Menambahkan Item Menu</h2>
        <p>
          Tambahkan item menu label yang diTingkatkan ke
          <code>app/Http/Middleware/AdminSidebarMenu.php</code> di bawah menu
          label yang sudah ada:
        </p>
        <pre><code>
            if (auth()->user()->can('product.view')) {
    $sub->url(
        action([\App\Http\Controllers\LabelsController::class, 'show']),
        __('barcode.print_labels'),
        ['icon' => '', 'active' => request()->segment(1) == 'labels' && request()->segment(2) == 'show']
    );

    // Add enhanced version
    $sub->url(
        action([\App\Http\Controllers\LabelsController::class, 'enhancedShow']),
        __('barcode.print_labels') . ' (Enhanced)',
        ['icon' => '', 'active' => request()->segment(1) == 'labels' && request()->segment(2) == 'enhanced-show']
    );
}
        </code></pre>
      </section>

      <section>
        <h2>‚úÖ Langkah 4: Membuat Tampilan yang Ditingkatkan</h2>
        <p>Tampilan Utama yang Ditingkatkan</p>
        <p>Buat <code>resources/views/labels/enhanced-show.blade.php</code>:</p>
        <a href="downloads/section2.html" download class="section-download"
          >‚¨áÔ∏è Unduh resources/views/labels/enhanced-show.blade.php</a
        >
        <p>Template Pratinjau yang Ditingkatkan</p>
        <p>
          Buat
          <code
            >resources/views/labels/partials/enhanced_preview.blade.php:</code
          >
        </p>
        <a href="downloads/section2.html" download class="section-download"
          >‚¨áÔ∏è Unduh
          resources/views/labels/partials/enhanced_preview.blade.php</a
        >
      </section>

      <section>
        <h2>‚úÖ Langkah 5: Buat Asset yang Ditingkatkan</h2>
        <h3>Stylesheet CSS yang Ditingkatkan</h3>
        <p>Buat public/css/enhanced-labels.css:</p>
        <a href="downloads/section2.html" download class="section-download"
          >‚¨áÔ∏è Unduh public/css/enhanced-labels.css</a
        >
        <h3>File JavaScript yang Ditingkatkan</h3>
        <p>Buat <code>public/js/labels-enhancements.js</code>:</p>
        <a href="downloads/section2.html" download class="section-download"
          >‚¨áÔ∏è Unduh public/js/labels-enhancements.js</a
        >
      </section>

      <section>
        <h2>‚úÖ Langkah 6: Perbarui JavaScript yang sudah ada</h2>
        <p>
          Perbarui file <code>public/js/labels.js</code> yang sudah ada dengan
          menambahkan panggilan <code>fetchPreview()</code> di dalam fungsi
          <code>get_label_product_row</code>:
        </p>
        <pre><code>
            function get_label_product_row(product_id, variation_id) {
    if (product_id) {
        var row_count = $('table#product_table tbody tr').length;
        $.ajax({
            method: 'GET',
            url: '/labels/add-product-row',
            dataType: 'html',
            data: {
                product_id: product_id,
                row_count: row_count,
                variation_id: variation_id,
            },
            success: function (result) {
                // Append the new row to the table
                $('table#product_table tbody').append(result);

                // Initialize date pickers for any new date input fields
                $('table#product_table tbody')
                    .find('.label-date-picker')
                    .each(function () {
                        $(this).datepicker({
                            autoclose: true,
                        });
                    });

                // Call fetchPreview to update the preview after the row is added
                fetchPreview(); // <-- ADD THIS LINE
            },
            error: function (xhr, status, error) {
                console.error('Error adding product row:', error);
            },
        });
    }
}
        </code></pre>
      </section>

      <section>
        <h2>‚úÖ Langkah 7: Impor Dependencies</h2>
        <p>Pastikan Anda memiliki dependensi yang diperlukan untuk pembuatan barcode di <code>composer.json</code> Anda:</p>
        <pre><code>
            {
    "require": {
        "milon/barcode": "^10.0"
    }
}
        </code></pre>
        <div class="tip">
          Jalankan <code>composer install</code> untuk menginstal dependensi jika belum terinstal.
        </div>
        </ul>
      </section>

      <section>
        <h2>Fitur & Manfaat</h2>
        <h3>Antarmuka Pengguna yang DiTingkatkan</h3>
        <ul>
            <li>Desain Modern: Antarmuka yang bersih dan responsif dengan tata letak berbasis kartu</li>
            <li>Toggle Switch: Kontrol hidup/mati yang intuitif untuk elemen label</li>
            <li>Kontrol Ukuran: Tombol plus/minus untuk penyesuaian ukuran yang mudah</li>
            <li>Pratinjau Waktu Nyata: Pembaruan pratinjau instan saat Anda melakukan perubahan</li>
        </ul>
        <h3>Kualitas Cetak yang Dioptimalkan</h3>
        <ul>
            <li>Barcode Resolusi Tinggi: Ukuran dinamis berdasarkan dimensi label</li>
            <li>Kode QR yang diTingkatkan: Koreksi dan resolusi kesalahan yang lebih baik</li>
            <li>Dukungan Printer Label: Mode cetak khusus untuk printer label termal</li>
            <li>Rendering Gambar yang lebih baik: Tepi yang tajam dan gaya cetak yang dioptimalkan</li>
        </ul>
        <h3>Fungsionalitas Tingkat Lanjut</h3>
        <ul>
            <li>Beberapa Sumber Gambar: Pilih antara logo bisnis atau URL khusus</li>
            <li>Pemformatan Mata Uang: Penempatan simbol mata uang yang tepat</li>
            <li>Dukungan Bidang Khusus: Penanganan otomatis bidang produk khusus</li>
            <li>Desain Responsif: Dapat digunakan di desktop, tablet, dan perangkat seluler</li>
        </ul>
      </section>

      <section>
        <h2>Penggunaan</h2>
        <p>Akses Label yang DiTingkatkan: Buka Produk > Cetak Label (DiTingkatkan) di menu bilah sisi</p>
        <p>Tambah Produk: Gunakan bidang pencarian untuk menemukan dan menambahkan produk ke kumpulan label Anda</p>
        <p>Konfigurasi Pengaturan:</p>
            <ul>
                <li>Mengaktifkan/menonaktifkan elemen label menggunakan sakelar</li>
                <li>Menyesuaikan ukuran menggunakan kontrol +/-</li>
                <li>Memilih sumber gambar jika diperlukan</li>
            </ul>
        <p>Pratinjau & Cetak:</p>
        <ul>
            <li>Lihat pratinjau waktu nyata di sebelah kanan</li>
            <li>Gunakan "Cetak Label" untuk pencetakan standar</li>
            <li>Gunakan "Printer Label" untuk printer label termal</li>
            <li>Gunakan "Kode QR" untuk label khusus kode QR</li>
        </ul>

        <h3>Contoh Label Barcode</h3>
        <div class="image-box">
          <img
            src="https://ultimate-pos-tutorials.vercel.app/assets/images/enhanced-labels-barcode-interface-3b0589e1211961b7739f3f5b7a93983a.png"
            alt="#"
          />
          <p class="caption">Gambar: Contoh Label Barcode.</p>
        </div>
        <p>Antarmuka yang diTingkatkan yang menampilkan label barcode tradisional dengan nama bisnis, detail produk, dan harga</p>

        <h3>Tangkapan layar di atas menunjukkan:</h3>
            <ul>
                <li>Keluaran Barcode: Barcode tradisional berkualitas tinggi dengan tampilan nama bisnis "ERP"</li>
                <li>Informasi Produk: Tata letak yang bersih dengan nama produk, harga, dan SKU</li>
                <li>Tata Letak Kisi: Kisi label 5x10 yang terorganisir yang menampilkan 50 label secara efisien</li>
                <li>Kontrol Pengalihan: Peralihan yang mudah antara mode kode batang dan kode QR</li>
            </ul>
      </section>

      <section>
        <h2>Opsi Kustomisasi</h2>
        <p>Ukuran Pencetak Label</p>
        <p>Anda dapat menyesuaikan dimensi label dengan memanggil fungsi <code>setLabelPrinterSize()</code>:</p>
        <pre><code>
            // Common label sizes in inches:
setLabelPrinterSize(1.125, 0.5); // 28.6mm x 12.7mm (address labels)
setLabelPrinterSize(1.1811, 0.5906); // 30mm x 15mm (default)
setLabelPrinterSize(2.125, 0.6875); // 54mm x 17.5mm (larger product labels)
setLabelPrinterSize(0.75, 0.5); // 19mm x 12.7mm (small price tags)
setLabelPrinterSize(4, 6); // 101.6mm x 152.4mm (shipping labels)
        </code></pre>
        <h3>Kustomisasi Style</h3>
        <p>Ubah enhanced-labels.css agar sesuai dengan warna dan preferensi merek Anda. CSS menggunakan properti khusus CSS untuk memudahkan pengaturan tema.</p>
      </section>
      <section>
        <h2>Pemecahan Masalah</h2>
        <h3>Masalah Umum</h3>
        <ul>
            <li>Pratinjau tidak dapat dimuat: Periksa konsol browser untuk kesalahan JavaScript</li>
            <li>Masalah kualitas cetak: Pastikan dimensi barcode yang tepat dalam pengaturan</li>
            <li>Gambar tidak ditampilkan: Verifikasi aksesibilitas URL gambar dan pengaturan CORS</li>
            <li>Format mata uang salah: Periksa pengaturan mata uang dalam konfigurasi bisnis</li>
        </ul>
        <h3>Kompatibilitas Peramban</h3>
        <ul>
            <li>Chrome 80+ (disarankan)</li>
            <li>Firefox 75+</li>
            <li>Safari 13+</li>
            <li>Edge 80+</li>
        </ul>
        <h3>Kesimpulan</h3>
        </code></pre>
        <div class="tip">
          Sistem pencetakan label yang disempurnakan memberikan peningkatan yang signifikan terhadap fungsionalitas label Ultimate POS standar, menawarkan kegunaan yang lebih baik, kualitas cetak, dan opsi penyesuaian. Pendekatan modular memastikan kompatibilitas dengan instalasi yang sudah ada sekaligus menyediakan fitur baru yang dahsyat untuk kebutuhan pencetakan label modern.
        </div>
      </section>
      <footer>
        <!-- HOME -->
        <div class="home-button-wrapper">
          <a href="index.html" class="home-button">üè† Kembali ke Beranda</a>
        </div>
      </footer>
    </div>
  </body>
</html>
