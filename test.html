<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Report Filter Enhancement Tutorial</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* Standard Fade-in Animation */
        .fade-in {
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }

        /* Fade-in Keyframes */
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                width: 95%;
            }

            h1 {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            h3 {
                font-size: 18px;
            }

            p, ul {
                font-size: 16px;
            }

            ul {
                padding-left: 20px;
            }

            li {
                margin-bottom: 10px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 20px;
            }

            h2, h3 {
                font-size: 18px;
            }

            p, ul {
                font-size: 14px;
            }
        }

        /* Ensure proper link styles */
        a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #2ecc71;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="fade-in" style="animation-delay: 0.3s;">Stock Report Filter Enhancement Tutorial</h1>
    <p class="fade-in" style="animation-delay: 0.6s;">This comprehensive tutorial guides you through enhancing the Stock Report functionality in Ultimate POS by adding advanced filtering capabilities including multi-select filters.</p>

    <h2 class="fade-in" style="animation-delay: 0.9s;">Overview</h2>
    <p class="fade-in" style="animation-delay: 1.2s;">This enhancement transforms the standard Stock Report into a powerful filtering tool with multi-select capabilities.</p>

    <h2 class="fade-in" style="animation-delay: 1.5s;">Stock Report Filter Enhancement</h2>
    <h3 class="fade-in" style="animation-delay: 1.8s;">What This Enhancement Adds</h3>
    <ul class="fade-in" style="animation-delay: 2.1s;">
        <li>Multi-select capability for all existing filters (Location, Category, Sub-category, Brand, Unit)</li>
        <li>Stock level filter with options: All, Greater than Zero, Less than One</li>
        <li>"All" option handling for improved user experience</li>
        <li>Improved filtering logic for better performance and accuracy</li>
    </ul>

    <h3 class="fade-in" style="animation-delay: 2.4s;">Benefits</h3>
    <ul class="fade-in" style="animation-delay: 2.7s;">
        <li>✅ Multi-dimensional Filtering: Select multiple categories, brands, locations simultaneously</li>
        <li>✅ Improved User Experience: Intuitive "All" options and clear filter states</li>
        <li>✅ Enhanced Performance: Optimized database queries for complex filters</li>
        <li>✅ Proper Currency Display: Consistent formatting with currency symbols</li>
    </ul>

    <h2 class="fade-in" style="animation-delay: 3s;">Implementation Steps</h2>
    <h3 class="fade-in" style="animation-delay: 3.3s;">Step 1: Update ReportController.php</h3>
    <h4 class="fade-in" style="animation-delay: 3.6s;">1.1 Add the Enhanced getStockValue Method</h4>
    <p class="fade-in" style="animation-delay: 3.9s;">Replace your existing getStockValue method with this enhanced version:</p>
    <pre><strong>app/Http/Controllers/ReportController.php</strong></pre>

    <h4 class="fade-in" style="animation-delay: 4.2s;">1.2 Add the processStockValueFilters Method</h4>
    <p class="fade-in" style="animation-delay: 4.5s;">Add this new private method to handle filter processing:</p>
    <pre><strong>app/Http/Controllers/ReportController.php</strong></pre>

    <h4 class="fade-in" style="animation-delay: 4.8s;">1.3 Update the getStockReport Method</h4>
    <p class="fade-in" style="animation-delay: 5.1s;">Update your existing getStockReport method to include the enhanced filter processing:</p>
    <pre><strong>app/Http/Controllers/ReportController.php</strong></pre>

    <h4 class="fade-in" style="animation-delay: 5.4s;">1.4 Add the processEnhancedStockReportFilters Method</h4>
    <p class="fade-in" style="animation-delay: 5.7s;">Add this method to handle enhanced stock report filtering:</p>
    <pre><strong>app/Http/Controllers/ReportController.php</strong></pre>

    <h3 class="fade-in" style="animation-delay: 6s;">Step 2: Update TransactionUtil.php</h3>
    <p class="fade-in" style="animation-delay: 6.3s;">Update your getOpeningClosingStock method to support multi-select filters:</p>
    <pre><strong>app/Utils/TransactionUtil.php</strong></pre>

    <h3 class="fade-in" style="animation-delay: 6.6s;">Step 3: Update the Blade View</h3>
    <p class="fade-in" style="animation-delay: 6.9s;">Replace your resources/views/report/stock_report.blade.php file with this enhanced version:</p>
    <pre><strong>resources/views/report/stock_report.blade.php</strong></pre>

    <h3 class="fade-in" style="animation-delay: 7.2s;">Step 4: Update public/js/report.js</h3>
    <p class="fade-in" style="animation-delay: 7.5s;">Update your public/js/report.js file to include the stock level filter in the DataTable configuration and change handlers.</p>

    <h4 class="fade-in" style="animation-delay: 7.8s;">4.1 Add Stock Level to DataTable Configuration</h4>
    <p class="fade-in" style="animation-delay: 8.1s;">Find your stock_report_table DataTable initialization and add the stock level parameter:</p>
    <pre><strong>public/js/report.js</strong></pre>

    <h4 class="fade-in" style="animation-delay: 8.4s;">4.2 Update Filter Change Handlers</h4>
    <p class="fade-in" style="animation-delay: 8.7s;">Update the change event handler to include the stock level filter:</p>
    <pre><strong>public/js/report.js</strong></pre>

    <h3 class="fade-in" style="animation-delay: 9s;">Step 5: Add Subcategory Methods to ProductController</h3>
    <h4 class="fade-in" style="animation-delay: 9.3s;">5.1 Add getSubCategories Method</h4>
    <p class="fade-in" style="animation-delay: 9.6s;">app/Http/Controllers/ProductController.php</p>

    <h4 class="fade-in" style="animation-delay: 9.9s;">5.2 Add getSubCategoriesMulti Method</h4>
    <p class="fade-in" style="animation-delay: 10.2s;">app/Http/Controllers/ProductController.php</p>

    <h4 class="fade-in" style="animation-delay: 10.5s;">5.3 Add Routes for Subcategory Methods</h4>
    <p class="fade-in" style="animation-delay: 10.8s;">Add these routes to your routes/web.php if they don't exist:</p>
    <pre><strong>routes/web.php</strong></pre>

    <h2 class="fade-in" style="animation-delay: 11.1s;">How It Works</h2>
    <h3 class="fade-in" style="animation-delay: 11.4s;">Multi-Select Filter Processing</h3>
    <p class="fade-in" style="animation-delay: 11.7s;">Frontend Collection: JavaScript collects values from multi-select dropdowns</p>
    <p class="fade-in" style="animation-delay: 12s;">Array Filtering: Empty values and "All" selections are filtered out</p>
    <p class="fade-in" style="animation-delay: 12.3s;">Backend Processing: PHP processes arrays and single values consistently</p>
    <p class="fade-in" style="animation-delay: 12.6s;">Database Querying: Uses whereIn() for arrays and where() for single values</p>

    <h3 class="fade-in" style="animation-delay: 12.9s;">Stock Value Calculation</h3>
    <p class="fade-in" style="animation-delay: 13.2s;">Filter Processing: Enhanced filters are processed and cleaned</p>
    <p class="fade-in" style="animation-delay: 13.5s;">Purchase Price Calculation: Uses getOpeningClosingStock() with by_sale_price = false</p>
    <p class="fade-in" style="animation-delay: 13.8s;">Sale Price Calculation: Uses getOpeningClosingStock() with by_sale_price = true</p>
    <p class="fade-in" style="animation-delay: 14.1s;">Currency Formatting: Backend formats values using num_f(value, true) for currency display</p>

    <h3 class="fade-in" style="animation-delay: 14.4s;">"All" Option Logic</h3>
    <p class="fade-in" style="animation-delay: 14.7s;">Empty dropdown selection = "All" (no filter applied)</p>
    <p class="fade-in" style="animation-delay: 15s;">Selecting "All" with other options removes the other options</p>
    <p class="fade-in" style="animation-delay: 15.3s;">Backend treats empty arrays as no filter applied</p>

    <h2 class="fade-in" style="animation-delay: 15.6s;">Key Features</h2>
    <ul class="fade-in" style="animation-delay: 15.9s;">
        <li>Multi-Select Capabilities
            <ul>
                <li>Multiple Locations: Filter by multiple business locations simultaneously</li>
                <li>Multiple Categories: Select multiple product categories</li>
                <li>Multiple Brands: Filter by multiple brands at once</li>
                <li>Multiple Units: Filter by different unit types</li>
            </ul>
        </li>
        <li>Enhanced Stock Value Display
            <ul>
                <li>Purchase Price Value: Total stock value at purchase price</li>
                <li>Sale Price Value: Total stock value at selling price</li>
                <li>Potential Profit: Difference between sale and purchase values</li>
                <li>Profit Margin: Percentage profit margin with proper formatting</li>
            </ul>
        </li>
        <li>Robust Error Handling
            <ul>
                <li>AJAX Error Management: Graceful error handling for network issues</li>
                <li>Filter Validation: Proper validation of filter inputs</li>
                <li>Currency Display: Consistent currency formatting across all values</li>
            </ul>
        </li>
    </ul>

    <h2 class="fade-in" style="animation-delay: 16.2s;">Benefits</h2>
    <ul class="fade-in" style="animation-delay: 16.5s;">
        <li>Improved User Experience: Intuitive multi-select interface with clear options</li>
        <li>Better Data Analysis: Multiple dimension filtering for comprehensive insights</li>
        <li>Consistent Formatting: Proper currency display with business-specific symbols</li>
        <li>Enhanced Performance: Optimized queries for multi-select filters</li>
        <li>Maintainable Code: Clean, well-structured code following Laravel best practices</li>
    </ul>

    <p class="fade-in" style="animation-delay: 16.8s;">This enhancement significantly improves the stock reporting capabilities while maintaining backward compatibility and following established patterns in your Ultimate POS application.</p>

</div>

</body>
</html>
